<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>emft.build &mdash; EMFT 0.5.3+14
(0.5.3) documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata" media="screen and (min-width:481px)" type="text/css" />

<link rel="stylesheet" href="../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../_static/css/bootstrap3/bootswatch-lumen.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" href="../../_static/css/adjust_theme/bootswatch-lumen.css" type="text/css" />

<link rel="stylesheet" href="../../_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../../_static/css/style.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '0.5.3+14(0.5.3)',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="EMFT 0.5.3+14
(0.5.3) documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-inverse" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">EMFT 0.5.3+14
(0.5.3) documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#" data-toggle="modal" data-target=".debug-modal">theme preview</a></li>

            
              <li><a href="../../py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="../../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="../index.html" accesskey="U">Module code</a></li>
            

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <h1>Source code for emft.build</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding=utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Collections of tools to build EMFT</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">import</span> <span class="nn">webbrowser</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="k">import</span> <span class="n">loads</span>

<span class="kn">import</span> <span class="nn">certifi</span>
<span class="kn">import</span> <span class="nn">click</span>

<span class="c1"># noinspection SpellCheckingInspection</span>
<span class="n">PYINSTALLER_NEEDED_VERSION</span> <span class="o">=</span> <span class="s1">&#39;3.3.dev0+g2fcbe0f&#39;</span>


<div class="viewcode-block" id="cd"><a class="viewcode-back" href="../../build.html#emft.build.cd">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">cd</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Context to temporarily change the working directory</span>

<span class="sd">    Args:</span>
<span class="sd">        path: working directory to cd into</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">old_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">old_dir</span><span class="p">)</span></div>


<div class="viewcode-block" id="repo_is_dirty"><a class="viewcode-back" href="../../build.html#emft.build.repo_is_dirty">[docs]</a><span class="k">def</span> <span class="nf">repo_is_dirty</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if the current repository contains uncommitted or untracked changes</span>

<span class="sd">    Returns: true if the repository is clean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">([</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;diff&#39;</span><span class="p">,</span> <span class="s1">&#39;--quiet&#39;</span><span class="p">,</span> <span class="s1">&#39;--cached&#39;</span><span class="p">,</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="ensure_repo"><a class="viewcode-back" href="../../build.html#emft.build.ensure_repo">[docs]</a><span class="k">def</span> <span class="nf">ensure_repo</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes sure the current working directory is EMFT&#39;s Git repository.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;.git&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;emft&#39;</span><span class="p">):</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;emft-build is meant to be ran in EMFT Git repository.</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;You can clone the repository by running:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">git clone https://github.com/132nd-etcher/EMFT.git</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;Then cd into it and try again.&#39;</span><span class="p">,</span>
                    <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="ensure_module"><a class="viewcode-back" href="../../build.html#emft.build.ensure_module">[docs]</a><span class="k">def</span> <span class="nf">ensure_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes sure that a module is importable.</span>

<span class="sd">    In case the module cannot be found, print an error and exit.</span>

<span class="sd">    Args:</span>
<span class="sd">        module_name: name of the module to look for</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ModuleNotFoundError</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;Module not found: </span><span class="si">{module_name}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">f</span><span class="s1">&#39;Install it manually with: &quot;pip install </span><span class="si">{module_name}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">f</span><span class="s1">&#39;Or install all dependencies with: &quot;pip install -r requirements-dev.txt&quot;&#39;</span><span class="p">,</span>
            <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="find_executable"><a class="viewcode-back" href="../../build.html#emft.build.find_executable">[docs]</a><span class="k">def</span> <span class="nf">find_executable</span><span class="p">(</span><span class="n">executable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>  <span class="c1"># noqa: C901</span>
    <span class="c1"># noinspection SpellCheckingInspection</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    https://gist.github.com/4368898</span>

<span class="sd">    Public domain code by anatoly techtonik &lt;techtonik@gmail.com&gt;</span>

<span class="sd">    Programmatic equivalent to Linux `which` and Windows `where`</span>

<span class="sd">    Find if ´executable´ can be run. Looks for it in &#39;path&#39;</span>
<span class="sd">    (string that lists directories separated by &#39;os.pathsep&#39;;</span>
<span class="sd">    defaults to os.environ[&#39;PATH&#39;]). Checks for all executable</span>
<span class="sd">    extensions. Returns full path or None if no command is found.</span>

<span class="sd">    Args:</span>
<span class="sd">        executable: executable name to look for</span>
<span class="sd">        path: root path to examine (defaults to system PATH)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">executable</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.exe&#39;</span><span class="p">):</span>
        <span class="n">executable</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{executable}</span><span class="s1">.exe&#39;</span>

    <span class="k">if</span> <span class="n">executable</span> <span class="ow">in</span> <span class="n">find_executable</span><span class="o">.</span><span class="n">known_executables</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="k">return</span> <span class="n">find_executable</span><span class="o">.</span><span class="n">known_executables</span><span class="p">[</span><span class="n">executable</span><span class="p">]</span>  <span class="c1"># type: ignore</span>

    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;looking for executable: </span><span class="si">{executable}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exec_prefix</span><span class="p">,</span> <span class="s1">&#39;Scripts&#39;</span><span class="p">))]</span> <span class="o">+</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">executable</span><span class="p">):</span>
        <span class="n">executable_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">path_</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="n">executable_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">executable</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">executable_path</span><span class="p">):</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; -&gt; not found&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="n">find_executable</span><span class="o">.</span><span class="n">known_executables</span><span class="p">[</span><span class="n">executable</span><span class="p">]</span> <span class="o">=</span> <span class="n">executable_path</span>  <span class="c1"># type: ignore</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; -&gt; {click.format_filename(executable_path)}&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">executable_path</span></div>


<span class="n">find_executable</span><span class="o">.</span><span class="n">known_executables</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: ignore</span>


<div class="viewcode-block" id="do_ex"><a class="viewcode-back" href="../../build.html#emft.build.do_ex">[docs]</a><span class="k">def</span> <span class="nf">do_ex</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">cmd</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">cwd</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a given command</span>

<span class="sd">    Args:</span>
<span class="sd">        ctx: Click context</span>
<span class="sd">        cmd: command to run</span>
<span class="sd">        cwd: working directory (defaults to &quot;.&quot;)</span>

<span class="sd">    Returns: stdout, stderr, exit_code</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_popen_pipes</span><span class="p">(</span><span class="n">cmd_</span><span class="p">,</span> <span class="n">cwd_</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_always_strings</span><span class="p">(</span><span class="n">env_dict</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            On Windows and Python 2, environment dictionaries must be strings</span>
<span class="sd">            and not unicode.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">env_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">env_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">env_dict</span>

        <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="n">cmd_</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">cwd</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cwd_</span><span class="p">),</span>
            <span class="n">env</span><span class="o">=</span><span class="n">_always_strings</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span>
                    <span class="c1"># try to disable i18n</span>
                    <span class="n">LC_ALL</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span>
                    <span class="n">LANGUAGE</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">HGPLAIN</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_stripped_str</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">str_or_bytes</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">str_or_bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_or_bytes</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_or_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s1">&#39;surogate_escape&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>

    <span class="n">exe</span> <span class="o">=</span> <span class="n">find_executable</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exe</span><span class="p">:</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">exe</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{cmd}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">_popen_pipes</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="p">)</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; -&gt; </span><span class="si">{p.returncode}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_ensure_stripped_str</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">out</span><span class="p">),</span> <span class="n">_ensure_stripped_str</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">err</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span></div>


<div class="viewcode-block" id="do"><a class="viewcode-back" href="../../build.html#emft.build.do">[docs]</a><span class="k">def</span> <span class="nf">do</span><span class="p">(</span>
    <span class="n">ctx</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span>
    <span class="n">cmd</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">cwd</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
    <span class="n">mute_stdout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">mute_stderr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># @formatter:off</span>
    <span class="n">filter_output</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span>
    <span class="c1"># @formatter:on</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a command and returns the result</span>

<span class="sd">    Args:</span>
<span class="sd">        ctx: click context</span>
<span class="sd">        cmd: command to execute</span>
<span class="sd">        cwd: working directory (defaults to &quot;.&quot;)</span>
<span class="sd">        mute_stdout: if true, stdout will not be printed</span>
<span class="sd">        mute_stderr: if true, stderr will not be printed</span>
<span class="sd">        filter_output: gives a list of partial strings to filter out from the output (stdout or stderr)</span>

<span class="sd">    Returns: stdout</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_filter_output</span><span class="p">(</span><span class="n">input_</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_filter_line</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="c1"># noinspection PyTypeChecker</span>
            <span class="k">for</span> <span class="n">filter_str</span> <span class="ow">in</span> <span class="n">filter_output</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filter_str</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">filter_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">input_</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">_filter_line</span><span class="p">,</span> <span class="n">input_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

    <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">do_ex</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mute_stdout</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;{_filter_output(out)}&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mute_stderr</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;{_filter_output(err)}&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;command failed: </span><span class="si">{cmd}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="get_gitversion"><a class="viewcode-back" href="../../build.html#emft.build.get_gitversion">[docs]</a><span class="k">def</span> <span class="nf">get_gitversion</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses GitVersion (https://github.com/GitTools/GitVersion) to infer project&#39;s current version</span>

<span class="sd">    Returns Gitversion JSON output as a dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;APPVEYOR&#39;</span><span class="p">):</span>
        <span class="n">exe</span> <span class="o">=</span> <span class="n">find_executable</span><span class="p">(</span><span class="s1">&#39;gitversion&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;C:\ProgramData\chocolatey\bin&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exe</span> <span class="o">=</span> <span class="n">find_executable</span><span class="p">(</span><span class="s1">&#39;gitversion&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exe</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span>
            <span class="s1">&#39;&quot;gitversion.exe&quot; not been found in your PATH.</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;GitVersion is used to infer the current version from the Git repository.</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;setuptools_scm plans on switching to using the Semver scheme in the future; when that happens, &#39;</span>
            <span class="s1">&#39;I</span><span class="se">\&#39;</span><span class="s1">ll remove the dependency to GitVersion.</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;In the meantime, GitVersion can be obtained via Chocolatey (recommended): &#39;</span>
            <span class="s1">&#39;https://chocolatey.org/packages/GitVersion.Portable</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;If you already have chocolatey installed, you can simply run the following command (as admin):</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&quot;choco install gitversion.portable -pre -y&quot;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;If you</span><span class="se">\&#39;</span><span class="s1">re not comfortable using the command line, there is a GUI tool for Chocolatey available at:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">https://github.com/chocolatey/ChocolateyGUI/releases</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Or you can install directly from :</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">https://github.com/GitTools/GitVersion/releases&#39;</span><span class="p">,</span>
            <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loads</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">getoutput</span><span class="p">([</span><span class="n">exe</span><span class="p">])</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span></div>


<div class="viewcode-block" id="get_pep440_version"><a class="viewcode-back" href="../../build.html#emft.build.get_pep440_version">[docs]</a><span class="k">def</span> <span class="nf">get_pep440_version</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Semver to a PEP440 version</span>

<span class="sd">    Args:</span>
<span class="sd">        version: valid Semver string</span>

<span class="sd">    Returns: valid PEP440 version</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">semantic_version</span>

    <span class="n">convert_prereleases</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
        <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
        <span class="s1">&#39;exp&#39;</span><span class="p">:</span> <span class="s1">&#39;rc&#39;</span><span class="p">,</span>
        <span class="s1">&#39;patch&#39;</span><span class="p">:</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">semver</span> <span class="o">=</span> <span class="n">semantic_version</span><span class="o">.</span><span class="n">Version</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">version_str</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{semver.major}</span><span class="s1">.</span><span class="si">{semver.minor}</span><span class="s1">.</span><span class="si">{semver.patch}</span><span class="s1">&#39;</span>
    <span class="n">prerelease</span> <span class="o">=</span> <span class="n">semver</span><span class="o">.</span><span class="n">prerelease</span>

    <span class="c1"># Pre-release</span>
    <span class="k">if</span> <span class="n">prerelease</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prerelease</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>

        <span class="c1"># Convert the pre-release tag to a valid PEP440 tag and strip it</span>
        <span class="k">if</span> <span class="n">prerelease</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">convert_prereleases</span><span class="p">:</span>
            <span class="n">version_str</span> <span class="o">+=</span> <span class="n">convert_prereleases</span><span class="p">[</span><span class="n">prerelease</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">prerelease</span> <span class="o">=</span> <span class="n">prerelease</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;unknown pre-release tag: </span><span class="si">{prerelease[0]}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># If there is a distance to the last tag, add a &quot;.dev[distance]&quot; suffix</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\d]+&#39;</span><span class="p">,</span> <span class="n">prerelease</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">version_str</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{prerelease[-1]}</span><span class="s1">&#39;</span>
            <span class="c1"># prerelease = prerelease[:-1]</span>

    <span class="c1"># Regular release</span>
    <span class="c1"># else:</span>
    <span class="c1">#     version_str = f&#39;{version_str.major}.{version_str.minor}.{version_str.patch}&#39;</span>

    <span class="c1"># Add SemVer, Sha and last commit date to the build tag</span>
    <span class="c1"># local_version = re.sub(r&#39;[^a-zA-Z0-9\.]&#39;, &#39;.&#39;, __version__.get(&#39;FullSemVer&#39;))</span>
    <span class="c1"># commit_date = re.sub(r&#39;-0&#39;, &#39;.&#39;, __version__.get(&#39;CommitDate&#39;))</span>
    <span class="c1"># version += f&#39;+{local_version}.{__version__.get(&quot;Sha&quot;)}.{commit_date}&#39;.replace(&#39;-&#39;, &#39;.&#39;)</span>

    <span class="k">return</span> <span class="n">version_str</span></div>


<span class="k">def</span> <span class="nf">_write_requirements</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">packages_list</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">prefix_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">source_file</span><span class="p">:</span>
        <span class="n">source_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">packages_list</span><span class="p">))</span>
    <span class="n">packages</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">do_ex</span><span class="p">(</span>
        <span class="n">ctx</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="s1">&#39;pip-compile&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--index&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--upgrade&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--annotate&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--no-header&#39;</span><span class="p">,</span>
            <span class="s1">&#39;-n&#39;</span><span class="p">,</span>
            <span class="s1">&#39;temp&#39;</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">req_file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">prefix_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">prefix_list</span><span class="p">:</span>
                <span class="n">req_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{prefix}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">req_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{package}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_install_pyinstaller</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Installs pyinstaller package from a custom repository</span>

<span class="sd">    The latest official master branch of Pyinstaller does not work with the version of Python I&#39;m using at this time</span>

<span class="sd">    Args:</span>
<span class="sd">        ctx: lick context (passed automatically by Click)</span>
<span class="sd">        force: uses &quot;pip --upgrade&quot; to force the installation of this specific version of PyInstaller</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">repo</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;git+https://github.com/132nd-etcher/pyinstaller.git@develop#egg=pyinstaller==3.3.dev0+g2fcbe0f&#39;</span>
    <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
        <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;--upgrade&#39;</span><span class="p">,</span> <span class="n">repo</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="n">repo</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">_get_version</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">_get_version</span><span class="o">.</span><span class="n">leave_me_alone_already</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">emft.__version_frozen__</span> <span class="k">import</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">__pep440__</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;semver&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__version__</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;pep440&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__pep440__</span>
    <span class="k">except</span> <span class="n">ModuleNotFoundError</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">pin_version</span><span class="p">)</span>

    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Semver: </span><span class="si">{ctx.obj[&#39;semver&#39;]}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;PEP440: </span><span class="si">{ctx.obj[&#39;pep440&#39;]}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

    <span class="n">_get_version</span><span class="o">.</span><span class="n">leave_me_alone_already</span> <span class="o">=</span> <span class="kc">True</span>


<span class="n">_get_version</span><span class="o">.</span><span class="n">leave_me_alone_already</span> <span class="o">=</span> <span class="kc">False</span>


<span class="c1"># noinspection PyUnusedLocal</span>
<span class="k">def</span> <span class="nf">_print_version</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">resilient_parsing</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">ensure_repo</span><span class="p">()</span>

    <span class="n">_get_version</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="c1"># @click.group(invoke_without_command=True)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">chain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">,</span>
              <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_eager</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">expose_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">_print_version</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Print version and exit&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">cli</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    emft-build is a tool that handles all the tasks to build a working EMFT application</span>

<span class="sd">    This tool is installed as a setuptools entry point, which means it should be accessible from your terminal once EMFT</span>
<span class="sd">    is installed in develop mode.</span>

<span class="sd">    Just activate your venv and type the following in whatever shell you fancy:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ensure_repo</span><span class="p">()</span>

    <span class="n">_get_version</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

    <span class="c1"># if ctx.invoked_subcommand is None:</span>
    <span class="c1">#     Checks.safety(ctx)</span>
    <span class="c1">#     Checks.flake8(ctx)</span>
    <span class="c1">#     Checks.pytest(ctx)</span>
    <span class="c1">#     # Checks.pylint()  # TODO</span>
    <span class="c1">#     # Checks.prospector()  # TODO</span>
    <span class="c1">#     HouseKeeping.compile_qt_resources(ctx)</span>
    <span class="c1">#     HouseKeeping.write_changelog(ctx, commit=True)</span>
    <span class="c1">#     HouseKeeping.write_requirements(ctx)</span>
    <span class="c1">#     Make.install_pyinstaller(ctx)</span>
    <span class="c1">#     Make.freeze(ctx)</span>
    <span class="c1">#     Make.patch_exe(ctx)</span>
    <span class="c1">#     Make.build_doc(ctx)</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--prod/--no-prod&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Whether or not to write &quot;requirement.txt&quot;&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--test/--no-test&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Whether or not to write &quot;requirement-test.txt&quot;&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--dev/--no-dev&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Whether or not to write &quot;requirement-dev.txt&quot;&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">reqs</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">prod</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">dev</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write requirements files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">find_executable</span><span class="p">(</span><span class="s1">&#39;pip-compile&#39;</span><span class="p">):</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;Missing module &quot;pip-tools&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;Install it manually with: &quot;pip install pip-tools&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;Or install all dependencies with: &quot;pip install -r requirements-dev.txt&quot;&#39;</span><span class="p">,</span>
                    <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prod</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>
        <span class="kn">from</span> <span class="nn">setup</span> <span class="k">import</span> <span class="n">install_requires</span>
        <span class="n">_write_requirements</span><span class="p">(</span>
            <span class="n">ctx</span><span class="p">,</span>
            <span class="n">packages_list</span><span class="o">=</span><span class="n">install_requires</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;requirements.txt&#39;</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Writes requirements-test.txt&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">setup</span> <span class="k">import</span> <span class="n">test_requires</span>
        <span class="n">_write_requirements</span><span class="p">(</span>
            <span class="n">ctx</span><span class="p">,</span>
            <span class="n">packages_list</span><span class="o">=</span><span class="n">test_requires</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;requirements-test.txt&#39;</span><span class="p">,</span>
            <span class="n">prefix_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-r requirements.txt&#39;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">dev</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Writes requirements-dev.txt&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">setup</span> <span class="k">import</span> <span class="n">dev_requires</span>
        <span class="n">_write_requirements</span><span class="p">(</span>
            <span class="n">ctx</span><span class="p">,</span>
            <span class="n">packages_list</span><span class="o">=</span><span class="n">dev_requires</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;requirements-dev.txt&#39;</span><span class="p">,</span>
            <span class="n">prefix_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-r requirements.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;-r requirements-test.txt&#39;</span><span class="p">]</span>
        <span class="p">)</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">pin_version</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes the project&#39;s version to &quot;emft/__version_frozen__.py (both Semver and PEP440)</span>

<span class="sd">    Args:</span>
<span class="sd">        ctx: click context (passed automatically by Click)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ensure_module</span><span class="p">(</span><span class="s1">&#39;semantic_version&#39;</span><span class="p">)</span>

    <span class="n">previous_version</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;semver&#39;</span><span class="p">)</span>

    <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_gitversion</span><span class="p">()</span>  <span class="c1"># this is needed for later patching</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;semver&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FullSemVer&quot;</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;pep440&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_pep440_version</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;semver&#39;</span><span class="p">])</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./emft/__version_frozen__.py&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">version_file</span><span class="p">:</span>
        <span class="n">version_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">f</span><span class="s2">&quot;# coding=utf-8</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">f</span><span class="s1">&#39;__version__ = </span><span class="se">\&#39;</span><span class="si">{ctx.obj[&quot;semver&quot;]}</span><span class="se">\&#39;\n</span><span class="s1">&#39;</span>
            <span class="n">f</span><span class="s1">&#39;__pep440__ = </span><span class="se">\&#39;</span><span class="si">{ctx.obj[&quot;pep440&quot;]}</span><span class="se">\&#39;\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">previous_version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;__version_frozen__.py written anew&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;semver&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">previous_version</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;New Semver: </span><span class="si">{ctx.obj[&#39;semver&#39;]}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;New PEP440: </span><span class="si">{ctx.obj[&#39;pep440&#39;]}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">chglog</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes the changelog</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: returns true if changes have been committed to the repository</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ensure_module</span><span class="p">(</span><span class="s1">&#39;gitchangelog&#39;</span><span class="p">)</span>
    <span class="n">find_executable</span><span class="p">(</span><span class="s1">&#39;git&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write the changelog using &quot;gitchangelog&quot; (https://github.com/vaab/gitchangelog)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">changelog</span> <span class="o">=</span> <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;gitchangelog&#39;</span><span class="p">,</span> <span class="s1">&#39;0.4.1..HEAD&#39;</span><span class="p">],</span> <span class="n">mute_stdout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;CHANGELOG.rst&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\s*\r\n){2,}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">changelog</span><span class="p">))</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">pyrcc</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compiles Qt resources (icons, pictures, ...)  to a usable python script</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: returns true if changes have been committed to the repository</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">find_executable</span><span class="p">(</span><span class="s1">&#39;pyrcc5&#39;</span><span class="p">):</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;Unable to find &quot;pyrcc5&quot; executable.</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="n">f</span><span class="s1">&#39;Install it manually with: &quot;pip install pyqt5&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="n">f</span><span class="s1">&#39;Or install all dependencies with: &quot;pip install -r requirements-dev.txt&quot;&#39;</span><span class="p">,</span>
                    <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span>
                    <span class="p">)</span>
    <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;pyrcc5&#39;</span><span class="p">,</span>
        <span class="s1">&#39;./emft/resources/qt_resource.qrc&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;./emft/resources/qt_resource.py&#39;</span><span class="p">,</span>
    <span class="p">])</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">pytest</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs Pytest (https://docs.pytest.org/en/latest/)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ensure_module</span><span class="p">(</span><span class="s1">&#39;pytest&#39;</span><span class="p">)</span>
    <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;pytest&#39;</span><span class="p">])</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">flake8</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs Flake8 (http://flake8.pycqa.org/en/latest/)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ensure_module</span><span class="p">(</span><span class="s1">&#39;flake8&#39;</span><span class="p">)</span>
    <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;flake8&#39;</span><span class="p">])</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">prospector</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs Landscape.io&#39;s Prospector (https://github.com/landscapeio/prospector)</span>

<span class="sd">    This includes flake8 &amp; Pylint</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ensure_module</span><span class="p">(</span><span class="s1">&#39;prospector&#39;</span><span class="p">)</span>
    <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;prospector&#39;</span><span class="p">])</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;emft&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;--reports&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Display full report&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--format&#39;</span><span class="p">,</span> <span class="s1">&#39;format_&#39;</span><span class="p">,</span>
              <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;parseable&#39;</span><span class="p">,</span> <span class="s1">&#39;colorized&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">]),</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;colorized&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">pylint</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">reports</span><span class="p">,</span> <span class="n">format_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze a given python SRC (module or package) with Pylint (SRC must exist)</span>

<span class="sd">    Default module: &quot;./emft&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ensure_module</span><span class="p">(</span><span class="s1">&#39;pylint&#39;</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pylint&#39;</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;--output-format=</span><span class="si">{format_}</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">reports</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--reports=y&#39;</span><span class="p">)</span>
    <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">safety</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs Pyup&#39;s Safety tool (https://pyup.io/safety/)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ensure_module</span><span class="p">(</span><span class="s1">&#39;safety&#39;</span><span class="p">)</span>
    <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;safety&#39;</span><span class="p">,</span> <span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="s1">&#39;--bare&#39;</span><span class="p">])</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="s1">&#39;--show&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Show the doc in browser&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--clean&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Clean build&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--publish&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Upload doc&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">doc</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">show</span><span class="p">,</span> <span class="n">clean</span><span class="p">,</span> <span class="n">publish</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds the documentation using Sphinx (http://www.sphinx-doc.org/en/stable)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">publish</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">pin_version</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_get_version</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">clean</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./doc/html&#39;</span><span class="p">):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;./doc/html&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./doc/api&#39;</span><span class="p">):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;./doc/api&#39;</span><span class="p">)</span>
    <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;sphinx-apidoc&#39;</span><span class="p">,</span>
        <span class="s1">&#39;emft&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;doc/api&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-H&#39;</span><span class="p">,</span> <span class="s1">&#39;EMFT API&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-A&#39;</span><span class="p">,</span> <span class="s1">&#39;132nd-etcher&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-V&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{ctx.obj[&quot;semver&quot;]}</span><span class="se">\n</span><span class="s1">(</span><span class="si">{ctx.obj[&quot;pep440&quot;]}</span><span class="s1">)&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;-P&#39;,</span>
        <span class="s1">&#39;-f&#39;</span><span class="p">,</span>
    <span class="p">])</span>
    <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;sphinx-build&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-b&#39;</span><span class="p">,</span>
        <span class="s1">&#39;html&#39;</span><span class="p">,</span>
        <span class="s1">&#39;doc&#39;</span><span class="p">,</span>
        <span class="s1">&#39;doc/html&#39;</span>
    <span class="p">])</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;file://{os.path.abspath(&quot;./doc/html/index.html&quot;)}&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">publish</span><span class="p">:</span>
        <span class="n">output_filter</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;warning: LF will be replaced by CRLF&#39;</span><span class="p">,</span>
            <span class="s1">&#39;The file will have its original line endings&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Checking out files:&#39;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./emft-doc&#39;</span><span class="p">):</span>
            <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;clone&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;https://github.com/132nd-etcher/emft-doc.git&#39;</span><span class="p">],</span> <span class="n">filter_output</span><span class="o">=</span><span class="n">output_filter</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="s1">&#39;./emft-doc&#39;</span><span class="p">):</span>
            <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;pull&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./docs&#39;</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;./docs&#39;</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="s1">&#39;../doc/html&#39;</span><span class="p">,</span> <span class="s1">&#39;./docs&#39;</span><span class="p">)</span>
            <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">],</span> <span class="n">filter_output</span><span class="o">=</span><span class="n">output_filter</span><span class="p">)</span>
            <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;commit&#39;</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;automated doc build&#39;</span><span class="p">],</span> <span class="n">filter_output</span><span class="o">=</span><span class="n">output_filter</span><span class="p">)</span>
            <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;push&#39;</span><span class="p">],</span> <span class="n">filter_output</span><span class="o">=</span><span class="n">output_filter</span><span class="p">)</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--install/--no-install&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;automatically install custom Pyinstaller version&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--force&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;force installation of needed version&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">freeze</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">install</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a Win32 executable file from EMFT&#39;s source</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">install</span><span class="p">:</span>
        <span class="n">_install_pyinstaller</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>

    <span class="n">pyinstaller_version</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">do_ex</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;PyInstaller&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">])</span>
    <span class="n">pyinstaller_version</span> <span class="o">=</span> <span class="n">pyinstaller_version</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;current version of pyinstaller: </span><span class="si">{pyinstaller_version}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="c1"># noinspection SpellCheckingInspection</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pyinstaller_version</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="n">PYINSTALLER_NEEDED_VERSION</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{PYINSTALLER_NEEDED_VERSION}</span><span class="s1">0&#39;</span><span class="p">):</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;EMFT needs a very specific version of PyInstaller to compile successfully.</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;You can force the installation of that version using the command:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">emft-build freeze --force&#39;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
        <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;PyInstaller&#39;</span><span class="p">,</span>
        <span class="s1">&#39;--log-level=WARN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;--noconfirm&#39;</span><span class="p">,</span> <span class="s1">&#39;--onefile&#39;</span><span class="p">,</span> <span class="s1">&#39;--clean&#39;</span><span class="p">,</span> <span class="s1">&#39;--windowed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;--icon&#39;</span><span class="p">,</span> <span class="s1">&#39;./emft/resources/app.ico&#39;</span><span class="p">,</span>
        <span class="s1">&#39;--workpath&#39;</span><span class="p">,</span> <span class="s1">&#39;./build&#39;</span><span class="p">,</span>
        <span class="s1">&#39;--distpath&#39;</span><span class="p">,</span> <span class="s1">&#39;./dist&#39;</span><span class="p">,</span>
        <span class="s1">&#39;--paths&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;{os.path.join(sys.exec_prefix, &quot;Lib/site-packages/PyQt5/Qt/bin&quot;)}&#39;</span><span class="p">,</span>
        <span class="s1">&#39;--add-data&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;{certifi.where()};.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;--name&#39;</span><span class="p">,</span> <span class="s1">&#39;EMFT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;./emft/main.py&#39;</span>
    <span class="p">])</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses &quot;verpatch&quot; (https://ddverpatch.codeplex.com) to write resource information into the PE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">find_executable</span><span class="p">(</span><span class="s1">&#39;verpatch&#39;</span><span class="p">):</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span>
            <span class="s1">&#39;&quot;verpatch.exe&quot; not been found in your PATH.</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Verpatch is used to embed resources like the version after the compilation.</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;I</span><span class="se">\&#39;</span><span class="s1">m waiting on PyInstaller to port their own resources patcher to Python 3 so I can remove the &#39;</span>
            <span class="s1">&#39;dependency to this external tool...</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;In the meanwhile, &quot;verpatch&quot; can be obtained at: https://ddverpatch.codeplex.com/releases&#39;</span><span class="p">,</span>
            <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span>
        <span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">pin_version</span><span class="p">)</span>

    <span class="n">year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
    <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;verpatch&#39;</span><span class="p">,</span>
        <span class="s1">&#39;./dist/EMFT.exe&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/high&#39;</span><span class="p">,</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;semver&#39;</span><span class="p">],</span>
        <span class="s1">&#39;/va&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/pv&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;semver&#39;</span><span class="p">],</span>
        <span class="s1">&#39;/s&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span> <span class="s1">&#39;EtchersMissionFilesTools&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/s&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;EMFT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/s&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;EMFT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/s&#39;</span><span class="p">,</span> <span class="s1">&#39;copyright&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{year}</span><span class="s1">-132nd-etcher&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/s&#39;</span><span class="p">,</span> <span class="s1">&#39;company&#39;</span><span class="p">,</span> <span class="s1">&#39;132nd-etcher,132nd-Entropy,132nd-Neck&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/s&#39;</span><span class="p">,</span> <span class="s1">&#39;SpecialBuild&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{ctx.obj[&quot;version&quot;][&quot;BranchName&quot;]}</span><span class="s1">@</span><span class="si">{ctx.obj[&quot;version&quot;][&quot;Sha&quot;]}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/s&#39;</span><span class="p">,</span> <span class="s1">&#39;PrivateBuild&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{ctx.obj[&quot;version&quot;][&quot;InformationalVersion&quot;]}</span><span class="s1">.</span><span class="si">{ctx.obj[&quot;version&quot;][&quot;CommitDate&quot;]}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/langid&#39;</span><span class="p">,</span> <span class="s1">&#39;1033&#39;</span><span class="p">,</span>
    <span class="p">])</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">test_build</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs the embedded tests in the resulting EMFT.exe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">do</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;./dist/emft.exe&#39;</span><span class="p">,</span> <span class="s1">&#39;--test&#39;</span><span class="p">])</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">pre_push</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is meant to be used as a Git pre-push hook</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">pin_version</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">reqs</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">chglog</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">pyrcc</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">chglog</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">flake8</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">safety</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">repo_is_dirty</span><span class="p">():</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;Repository is dirty&#39;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">test_local_build</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is meant to be used as a Git pre-push hook</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">pin_version</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">flake8</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">pytest</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">pyrcc</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">freeze</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">test_build</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">cli</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="p">{})</span>
</pre></div>

                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-inverse" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../../index.html">EMFT 0.5.3+14
(0.5.3) documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="../../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../../genindex.html" title="General Index" >index</a></li>
        <li><a href="../index.html" >Module code</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2017, 132nd-etcher.
        Last updated on 07 Oct 2017.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

<img src="../../_static/css/bootstrap2/bootswatch-amelia.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-cerulean.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-cosmo.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-cyborg.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-flatly.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-journal.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-readable.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-simplex.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-slate.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-spacelab.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-spruce.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-superhero.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/bootswatch-united.css" style="display:none;" />
<img src="../../_static/css/bootstrap2/geo-bootstrap.css" style="display:none;" />

<img src="../../_static/css/bootstrap3/bootswatch-amelia.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-cerulean.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-cosmo.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-cyborg.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-darkly.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-flatly.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-journal.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-lumen.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-paper.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-readable.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-sandstone.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-simplex.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-slate.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-spacelab.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-superhero.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-united.css" style="display:none;" />
<img src="../../_static/css/bootstrap3/bootswatch-yeti.css" style="display:none;" />

<img src="../../_static/css/adjust_theme/bootswatch-amelia.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-cerulean.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-cosmo.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-cyborg.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-darkly.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-flatly.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-journal.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-lumen.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-paper.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-readable.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-sandstone.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-simplex.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-slate.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-spacelab.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-spruce.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-superhero.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-united.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/bootswatch-yeti.css" style="display:none;" />
<img src="../../_static/css/adjust_theme/geo-bootstrap.css" style="display:none;" />

<div class="modal fade debug-modal" style="display:none;" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <p class="modal-title" id="myLargeModalLabel">Inner theme preview</p>
      </div>

      <div class="modal-body">
        <form class="form-inline" role="form">
          <div class="form-group">
            <select id="select-theme" class="form-control" style="width:200px;">
              <option value="">default</option>
              <option value="bootswatch-amelia">bootswatch-amelia</option>
              <option value="bootswatch-cerulean">bootswatch-cerulean</option>
              <option value="bootswatch-cosmo">bootswatch-cosmo</option>
              <option value="bootswatch-cyborg">bootswatch-cyborg</option>
              <option value="bootswatch-flatly">bootswatch-flatly</option>
              <option value="bootswatch-journal">bootswatch-journal</option>
              <option value="bootswatch-readable">bootswatch-readable</option>
              <option value="bootswatch-simplex">bootswatch-simplex</option>
              <option value="bootswatch-slate">bootswatch-slate</option>
              <option value="bootswatch-spacelab">bootswatch-spacelab</option>
              <option value="bootswatch-superhero">bootswatch-superhero</option>
              <option value="bootswatch-united">bootswatch-united</option>
              <option value="bootswatch-paper">bootswatch-paper</option>
              <option value="bootswatch-sandstone">bootswatch-sandstone</option>
              <option value="bootswatch-darkly">bootswatch-darkly</option>
              <option value="bootswatch-lumen">bootswatch-lumen</option>
              <option value="bootswatch-yeti">bootswatch-yeti</option>
            </select><br />
          </div>
          <div class="checkbox">
            &nbsp;
            <label>
              &nbsp;<input type="checkbox" id="select-header-inverse"> Header inverse color
            </label>
          </div>
          <div class="checkbox">
            &nbsp;
            <label>
              &nbsp;<input type="checkbox" id="select-relbar-inverse"> Relbar inverse color
            </label>
          </div>
        </form>
        <span id="bootstrap-version" style="display:none">3</span>
        <p style="padding-top:10px">
        If you add the following options in conf.py, you can apply the design.
        </p>

        <div id="quick-preview-theme-options" class="highlight-python">
          <div class="highlight">
            <pre>html_theme_options = {
   'header_inverse': False,
   'relbar_inverse': False,
   'inner_theme': False,
}
            </pre>
          </div>
        </div>

      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

  </body>
</html>